<!DOCTYPE html>
<html>
<head>
    <title>Video Upload Site</title>
    <style>
        .video-container {
            margin: 20px 0;
        }
        video {
            max-width: 100%;
            max-height: 500px;
        }
    </style>
</head>
<body>
    <h1>Video Upload Site</h1>
    
    <form id="uploadForm">
        <input type="file" name="video" accept="video/*" required>
        <button type="submit">Upload Video</button>
    </form>

    <div id="videoList"></div>

    <script>
        async function loadVideos() {
            try {
                const response = await fetch('/videos');
                const videos = await response.json();
                const videoList = document.getElementById('videoList');
                videoList.innerHTML = '';
                
                videos.forEach(video => {
                    const container = document.createElement('div');
                    container.className = 'video-container';
                    
                    const videoElement = document.createElement('video');
                    videoElement.src = `/video/${video.id}`;
                    videoElement.controls = true;
                    
                    container.appendChild(videoElement);
                    videoList.appendChild(container);
                });
            } catch (error) {
                console.error('Failed to load videos:', error);
            }
        }

        document.getElementById('uploadForm').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }
                
                await loadVideos();
                e.target.reset();
            } catch (err) {
                console.error('Upload failed:', err);
                alert('Upload failed: ' + err.message);
            }
        };

        loadVideos();
    </script>
</body>
</html>
